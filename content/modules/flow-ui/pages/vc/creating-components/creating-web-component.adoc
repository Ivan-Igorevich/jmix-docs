= 创建 Web 组件

可以基于 https://polymer-library.polymer-project.org/[Polymer 3^] 或 https://lit.dev/[Lit^] 库创建自己的 https://vaadin.com/docs/latest/flow/create-ui/web-components/introduction-to-webcomponents[Web 组件^]。实现 JavaScript Web 组件后，可以为其创建 Java API。

下面的示例展示基于 https://lit.dev/[Lit^] 如何创建明暗主题切换的开关。

[[web-component]]
== 创建 JavaScript Web 组件

在 `frontend/src/component/theme-toggle` 文件夹创建 `theme-toggle.js` 文件。其中包含一个 Web 组件，实现了明暗主题切换的开关。

[source,javascript,indent=0]
----
include::example$/onboarding/frontend/src/component/theme-toggle/theme-toggle.js[tags=web-component]
----
<1> 自定义组件的基类。由于 `ThemeToggle` 需要与按钮的外观和行为类似，因此使用了 `ButtonMixin` 基类，可以提供按钮相关的属性和操作。
<2> 定义 HTML 元素的名称。
<3> 定义组件的样式，使用了导入的 `vaadin-button` 样式和自定义样式。
<4> 定义 Shadow DOM 模板。
<5> 自定义属性。
<6> 初始化 `TooltipController` 类，用于处理提示框的变化。控制器类用作视觉组件的重复功能的代理。
<7> 发送名为 `theme-changed` 的自定义事件。
<8> 使用在 `static get is()` 方法中定义的名称导出自定义 HTML 元素。


[[creating-web-component-java-api]]
== 为 Web 组件创建 Java API

创建 `ThemeToggle.java` 文件，这是一个 UI 组件类。为服务端代码、访问方法、事件监听器和数据源连接定义了 API。

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/component/ThemeToggle.java[tags=web-component]
----
<1> 定义由 Component` 类自动创建的 *根* 元素，可以通过 `getElement()` 方法访问。必须与 Web 组件导出的相同。
<2> `@JsModule` 注解定义需要导入 JavaScript 模块。
<3> 使用 https://vaadin.com/docs/latest/flow/create-ui/creating-components/mixins[Vaadin Mixin 接口^] 为 Web 组件中的大部分功能集提供通用 API 和默认行为。
<4> 使用 `@DomEvent` 注解关联 ThemeToggle 组件与 `theme-changed` DOM 事件。
<5> 使用 `@EventData` 注解定义附加的事件数据，这里用到了主题值。


TIP: 关于创建自定义组件的更多内容可以参阅 Vaadin 文档： https://vaadin.com/docs/latest/flow/create-ui/creating-components[创建组件^]、 https://vaadin.com/docs/latest/flow/create-ui/creating-components/mixins[使用 Vaadin Mixin 接口^]、 https://vaadin.com/docs/latest/flow/create-ui/creating-components/events[使用组件事件^]。

[[usage-example]]
== 用例

组件实现完成后，可以在视图中使用，示例：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/customcomponent/themetoggle/ThemeToggleView.java[tags=component-usage]
----

image::visual-components/creating-components/theme-toggle-usage.gif[align="center", width="325"]
