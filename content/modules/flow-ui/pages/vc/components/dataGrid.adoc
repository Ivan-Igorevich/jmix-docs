= dataGrid 数据网格

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/ui-samples/sample/data-grid-simple" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

`dataGrid` 用于展示、排序表格类数据，由于使用了在滚动时加载数据的延迟加载方式，所以此组件具有更好的数据行、列操作性能。

* XML 元素：`dataGrid`

* Java 类：`DataGrid`

== 基本用法

一个在 XML 视图描述声明 `dataGrid` 的示例如下：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/datagrid/data-grid-view.xml[tags=data;usersDc;layout;basics]
----

<1> `User` 实体的 xref:flow-ui:data/collection-container.adoc[集合数据容器]。
<2> `dataGrid` 使用 `dataContainer` 属性绑定 `usersDc` 数据容器。
<3> `columns` 元素定义在数据网格中展示哪些实体属性。

image::visual-components/components/data-grid-basics.png[align="center", width="732"]

[[data-binding]]
== 数据绑定

[[declarative-binding]]
=== 声明式绑定

通常，使用 `dataContainer` 属性在视图 XML 描述中将数据与 `dataGrid` 绑定。此时需要使用一个 xref:flow-ui:data/collection-container.adoc[集合数据容器]。

[[key-value-containers-binding]]
=== 使用键值对容器

数据网格还可以绑定至 xref:flow-ui:data/key-value-containers.adoc[键值对容器] 展示查询的纯数值和聚合值。示例：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/datagrid/data-grid-view.xml[tags=data;keyValueCollection;layout;with-key-value]
----

[[programmatic-binding]]
=== 编程式绑定

如需以编程的方式在视图控制器定义数据容器，则可以在 XML 中设置 xref:flow-ui:vc/common-attributes.adoc#metaClass[metaClass] 属性而非 xref:flow-ui:vc/common-attributes.adoc#dataContainer[dataContainer]。

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/datagrid/data-grid-view.xml[tags=metaClass]
----

视图控制器中，使用 `ContainerDataGridItems` 类将数据网格和数据容器绑定：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/datagrid/DataGridView.java[tags=dataGrid;usersDc;onInit;setItems]
----

[[columns]]
== columns 元素

数据网格的列集合定义在 `columns` 元素中。`columns` 元素有如下属性：

[[includeAll]]
* `includeAll` - 加载数据容器中 xref:data-access:fetching.adoc#fetch-plan[fetch plan] 的所有属性。
+
在下面的例子中，我们显示了 `usersDc` 中使用 fetch plan 的所有属性：
+
[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/datagrid/data-grid-view.xml[tags=includeAll]
----
+
如果实体的 fetch plan 包含引用属性，该属性会按照其 xref:data-model:entities.adoc#instance-name[实例名] 进行展示。如果需要展示一个特定的级联属性，则需要在 fetch plan 和 `column` 元素中定义：
+
[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/datagrid/data-grid-view.xml[tags=data;userStepsDc;layout;includeAllReference]
----

* `exclude` - 英文逗号分隔的属性列表，这些属性不会被加载到数据网格。
+
在下面的例子中，我们会显示除了 `id`、`version` 和 `sortValue` 之外的所有属性：
+
[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/datagrid/data-grid-view.xml[tags=exclude]
----

[[column]]
== column 元素

每一列是在内部的 `column` 元素中描述。

[TIP]
====
如需在 Jmix Studio 中添加 `column`，可以在视图 XML 或者 *Jmix UI* 结构面板中选择 `columns` 元素，然后点击组件面板的 xref:studio:view-designer.adoc#add-column[Add->Column] 按钮。
====

[[autoWidth]]
=== autoWidth

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/grid/#column-width" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

为该列启用/禁用自动列宽。

当 `autoWidth = true` 时，列的宽度依据内容自动调整。

该属性默认为 `false`。

[[editable]]
=== editable

为该列创建一个编辑器组件。

参考 <<inline-editing,行内编辑>>。

[[flexGrow]]
=== flexGrow

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/grid/flow/#setting-column-widths" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

设置列的 flex grow 比例。当设置成 `0` 时，列宽固定。

[[filterable]]
=== filterable

设置列的 <<column-filtering,filtering>> 属性。如果某列启用了过滤，则会在列的表头中添加一个过滤按钮。默认禁用列过滤。

[[footer]]
=== footer

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/grid/#column-headers-footers" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

设置列的 footer 文本。

该属性可以是文本本身或者 xref:localization:message-bundles.adoc[消息包] 中的一个键值。如果是消息包键值，则必须以 `msg://` 开头。

[[frozen]]
=== frozen

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/grid/#column-freezing" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

设置是否锁定该列。

NOTE: 列锁定是 UI 层操作，如需锁定请从左往右锁定，以得到更流畅的展示。

[[header]]
=== header

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/grid/#column-headers-footers" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

设置列的 header。

该属性可以是文本本身或者 xref:localization:message-bundles.adoc[消息包] 中的一个键值。如果是消息包键值，则必须以 `msg://` 开头。

[[key]]
=== key

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/grid/flow/#column-keys" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

设置用户定义的列映射 id。这个键值可以用来通过 `getColumnByKey(String)` 方法获取该列。

键值必须在同一个数据网格中唯一，设定后不能更改。

[[property]]
=== property

`property` 指定列对应的实体属性。可以是数据容器实体的属性，也可以是关联实体的属性，关联实体属性前面需要加上关联类名字并通过 “.” 连接。例如：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/datagrid/data-grid-view.xml[tags=column-property]
----

[[resizable]]
=== resizable

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/grid/#column-reordering-resizing" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

当设置为 `true` 时，用户可以手动调整列宽。该属性默认为 `false`。

列宽变化事件可以通过 <<ColumnResizeEvent>> 跟踪。

[[sortable]]
=== sortable

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/grid/#sorting" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

设置用户是否能对该列排序。

`dataGrid` 的排序事件可以通过 <<SortEvent>> 跟踪。

[[textAlign]]
=== textAlign

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/grid/#column-alignment" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

设置列的文字对齐。

支持三种不同的对齐方式：`START`（默认）、`CENTER`、`END`。

[[visible]]
=== visible

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/grid/#column-visibility" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

设置列可见性。

[[width]]
=== width

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/grid/#column-width" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

使用 CSS 字符串设置列宽。

[[column-filtering]]
== 表头过滤

CAUTION: 该功能目前是预览状态。其显示以及实现细节可能会在未来的版本中发生重大变化。

`dataGrid` 中的数据可以使用列标题中嵌入的 xref:flow-ui:vc/components/propertyFilter.adoc[属性过滤器] 进行过滤。

可以通过 XML 中的 `filterable` 属性定义哪些列可以进行过滤。可过滤的列表头中带有“漏斗”图标（image:visual-components/components/funnel.svg[]）。用户点击图标时，会显示一个包含属性过滤条件的对话框。如果设置了过滤条件，则该列中的图标将高亮显示。

若要确保过滤器图标始终正常显示，请使用 `width` 或 `autoWidth` 属性为列设置适当的宽度。最好不要让用户能调整列宽，否则用户有可能调小列宽导致过滤器图标不可见。

示例：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/datagrid/data-grid-features-view.xml[tags=filterable]
----

表头中的属性过滤器与独立属性过滤器或 xref:flow-ui:vc/components/genericFilter.adoc[] 的工作方式相同 - 都是在 xref:flow-ui:data/data-loaders.adoc[数据加载器] 中添加查询条件。在标准流程中，过滤条件将转换为 JPQL 查询语句，并在数据库级别筛选数据。

可过滤的列可以与 `propertyFilter` 和 `genericFilter` 组件一起使用。所有过滤器的条件都由以 `AND` 逻辑运算进行组合。

目前，列过滤条件还没有绑定到页面的 URL 中。也就是说，如果用户使用了表头过滤器，然后导航到详情视图并返回，则表头过滤器将被清除。

[[actions]]
== 操作

`dataGrid` 组件实现了 `HasActions` 接口，可以包含自定义操作和标准列表操作。

数据网格的操作定义在内部的 `actions` 元素中。

[TIP]
====
如需在 Jmix Studio 中添加 `action`，可以在视图 XML 或者 *Jmix UI* 结构面板中选择组件，然后点击组件面板的 xref:studio:view-designer.adoc#add-action[Add->Action] 按钮。
====

如果操作有 xref:flow-ui:vc/common-attributes.adoc#text[标题]，则会显示在数据网格的右键菜单中。此外，数据网格的操作可以分配给视图中任意位置的 xref:flow-ui:vc/components/button.adoc[按钮]。

可以用 `hbox` 容器在数据网格上方显示操作按钮。

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/datagrid/data-grid-view.xml[tags=dataGrid-actions]
----

<1> 在数据网格上方定义一个 `buttonsPanel` `hbox` 容器。
<2> 定义 `list_create` 标准操作。
<3> 定义 `getInfo` 自定义操作

image::visual-components/components/data-grid-actions.png[align="center", width="732"]

[[renderers]]
== 渲染器

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/grid/flow/#using-renderers-in-columns" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

渲染器（Renderers）用来为数据网格中的数据实现自定义的展示方式。例如，可以用渲染器：

* 格式化日期或数字。
* 显示自定义的图标或图片。
* 创建可交互的元素，比如按钮、链接等。
* 根据单元格值的不同显示不同的内容。

渲染器可以通过三种方式定义：

* *在 XML 中声明式定义*
+
XML 中可以使用一些预定义的列渲染器：

** `numberRenderer`
** `localDateRenderer`
** `localDateTimeRenderer`
+
这些渲染器需要传入一个 `format` 字符串。示例：
+
[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/datagrid/data-grid-view.xml[tags=localDateRenderer]
----
+
[TIP]
====
如需通过 Jmix Studio 添加一个渲染器，在视图 XML 或 *Jmix UI* 的结构面板中选中 `column` 元素并点击属性面板中的 xref:studio:view-designer.adoc#component-inspector[Add-><Some>Renderer]。
====

* *使用 @Supply 注解定义*
+
渲染器可以在视图控制器中通过 `@Supply` 注解提供。使用 `@Supply` 注解的方法需要返回一个值，该值传递给“主体”中定义的一个方法。
+
[TIP]
====
自定义的列渲染器可以用列的 `renderer` 处理方法定义，该方法可以在 Jmix Studio 中通过 `column` 元素属性面板的 *Handlers* 标签页创建。
====
+
[TIP]
====
<<column,column>> 元素定义时，可以不使用 <<property,property>> 属性，即不直接绑定实体的某个属性。此时，`column` 元素必须带具有唯一值的 <<key,key>> 属性。
====
+
可以参考 <<text-renderer>> 和 <<component-renderer>> 示例。

* *通过 addColumn() 和 addComponentColumn() 方法定义*
+
`addColumn()` 和 `addComponentColumn()` 方法可以在数据网格中添加列。
+
可以配置新添加的列使用渲染器展示数据。
+
下面的示例中，我们添加一列用于展示用户的图片：
+
[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/datagrid/DataGridView.java[tags=usersDtGr;fileStorage;onInit;addComponentColumn]
----
<1> 添加一列，显示 `image` 组件。
<2> `Image` 组件的实例使用 `UiComponents` 工厂创建。
<3> `image` 从给定的 `StreamResource` 获取内容，存储在 `User` 实体的 `picture` 属性中。
<4> `addComponentColumn()` 方法返回的可视化组件展示在列单元格中。

[[local-date-renderer]]
=== 本地日期渲染器

`LocalDateRenderer` 用于以 `LocalDate` 值的形式展示日期。

在数据网格的 `column` 元素中，支持 `localDateRenderer` 子元素，该元素可以包含一个可选的 `nullRepresentation` 属性和一个必需的 `format` 字符串属性。

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/datagrid/data-grid-view.xml[tags=localDateRenderer]
----

`nullRepresentation` 属性用于展示 `null` 值的文本。

下面的示例中，在 `addColumn()` 方法使用了 `LocalDateRenderer`：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/datagrid/DataGridView.java[tags=usersDtGr;onInit;addJoiningDate]
----

[[local-date-time-renderer]]
=== 本地日期时间渲染器

`LocalDateTimeRenderer` 用于以 `LocalDateTime` 值的形式展示日期。

在数据网格的 `column` 元素中，支持 `localDateTimeRenderer` 子元素，该元素可以包含一个可选的 `nullRepresentation` 属性和一个必需的 `format` 字符串属性。

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/datagrid/data-grid-view.xml[tags=localDateTimeRenderer]
----

`nullRepresentation` 属性用于展示 `null` 值的文本。

[[number-renderer]]
=== 数字渲染器

`NumberRenderer` 用于在单元格中以指定的格式显示数字。

在数据网格的 `column` 元素中，支持 `numberRenderer` 子元素，该元素可以包含一个可选的 `nullRepresentation` 属性和一个必需的 `format` 或 `numberFormat` 字符串属性。

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/datagrid/data-grid-view.xml[tags=numberFormat]
----

`nullRepresentation` 属性用于展示 `null` 值的文本。

`numberFormat` 属性需按照 `java.text.DecimalFormat` 类规定的格式和语法进行配置。

[NOTE]
====
`numberRenderer` 需且仅需定义一个格式，`format` 或 `numberFormat`。如果未定义或两者都定义会抛出 `GuiDevelopmenException` 异常。
====

[[text-renderer]]
=== 文本渲染器

`TextRenderer` 渲染器用于展示文本。

下面的示例中，列展示了一个自定义的文本：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/datagrid/data-grid-view.xml[tags=textRenderer]
----

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/datagrid/DataGridView.java[tags=textRenderer]
----

[[component-renderer]]
=== 组件渲染器

下面的示例显示如何在列中使用一个自定义的渲染器显示一个复选框：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/datagrid/data-grid-view.xml[tags=completed]
----

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/datagrid/DataGridView.java[tags=ComponentRenderer]
----

[[inline-editing]]
== 行内编辑

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/grid/#inline-editing-java-only" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

`dataGrid` 组件支持行内编辑器来编辑单元格数据。

带有 <<editable,editable = true>> 属性的列展示实体属性编辑的组件。每个可编辑列的编辑组件是根据对应实体的属性自动选取的。

<<editorBuffered,editorBuffered>> 属性定义行内编辑器是否启用缓存模式。缓存模式：修改后的数据需要显式提交。

* 如需将某些列设为可编辑，请设置 <<editable,editable>> 属性为 `true`。

* 然后，就可以通过编程的方式编辑某一行，参考 https://vaadin.com/docs/latest/components/grid#inline-editing-java-only[Vaadin 文档^]；或者定义 <<editorActionsColumn,editorActionsColumn>> 元素，示例：
+
[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/datagrid/data-grid-view.xml[tags=dataGrid-editable-simple]
----
+
image::visual-components/components/data-grid-editing.gif[align="center"]

[[editorActionsColumn]]
=== editorActionsColumn

`editorActionsColumn` 元素用来创建自定义带编辑按钮的列。

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/datagrid/data-grid-view.xml[tags=editorActionsColumn]
----

编辑列中可以包含下列按钮：

* `editButton` - 开始编辑。适用于缓存或非缓存模式。
* `saveButton` - 保存编辑列中的改动。适用于缓存模式。
* `cancelButton` - 丢弃编辑列中的改动。适用于缓存模式。
* `closeButton` - 关闭编辑模式。仅适用于非缓存模式。

每个按钮仅支持标准按钮的有限几个属性：xref:flow-ui:vc/common-attributes.adoc#text[text]、`icon`、xref:flow-ui:vc/common-attributes.adoc#title[title]、xref:flow-ui:vc/common-attributes.adoc#classNames[classNames]、xref:flow-ui:vc/common-attributes.adoc#themeNames[themeNames]、`iconAfterText`。

编辑列会相对其他列添加到表格中。如果是 `includeAll="true"`，编辑列添加在最后。

[[DataGridEditor]]
=== DataGridEditor

`io.jmix.flowui.component.grid.editor.DataGridEditor` 接口提供了更多的编辑器功能：配置编辑器、打开编辑器、保存和取消行编辑以及定义列编辑组件的一些工具方法。

WARNING: 为了支持框架的底层机制，例如数据容器、源值等，列编辑组件必须通过 `DataGridEditor` 的方法（`DataGridEditor#setColumnEditorComponent()`）进行添加，不能直接使用列 API 的 `Column#setEditorComponent()` 方法。

示例：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/datagrid/DataGridView.java[tags=uiComponents;editableUserTable;onInit;DataGridEditor]
----
<1> 获取 `DataGridEditor` 实例。
<2> `JmixComboBox` 组件实例用 `UiComponents` 工厂创建。
<3> 设置 <<SupportsStatusChangeHandler,StatusChangeHandler>>.
<4> `setColumnEditorComponent()` 方法返回的可视化组件将作为列编辑组件。

[[SupportsStatusChangeHandler]]
=== SupportsStatusChangeHandler

默认情况下，字段组件（例如，xref:flow-ui:vc/components/textField.adoc[textField]、xref:flow-ui:vc/components/comboBox.adoc[comboBox]）会在组件上方展示错误信息。但是在区域有限的单元格编辑器中，这种方式就不合适了。`io.jmix.flowui.component.SupportsStatusChangeHandler` 接口支持定义以不同的方式展示错误信息。实现了这个接口的组件支持错误信息代理。

行内编辑器默认使用 `StatusChangeHandler`，会将错误信息作为组件的 xref:flow-ui:vc/common-attributes.adoc#title[title] 展示。

[[double-click-editing]]
=== 双击编辑

有时候我们需要通过双击的方式打开行内编辑器。示例：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/datagrid/data-grid-view.xml[tags=dblClickTable]
----

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/datagrid/DataGridView.java[tags=dblClickTable;onInit;addItemDoubleClickListener]
----

[[multiple-sorting]]
== 多列排序

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/grid#sorting-by-multiple-columns" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

`dataGrid` 支持按多个列进行排序。可以用下列 XML 属性配置：

[[multiSort]]
=== multiSort

启用多列排序。

[[multiSortOnShiftClickOnly]]
=== multiSortOnShiftClickOnly

当设置为 `true` 时，仅当按住 `Shift` 键并单击列标题时，才会激活多列排序。默认值为 `false`。

[[multiSortPriority]]
=== multiSortPriority

设置为 `APPEND` 时，单击的列将添加到排序列列表的末尾。如果设置为 `PREPEND`（默认值），则单击的列将添加到列表的开头。

示例：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/datagrid/data-grid-view.xml[tags=multiSort]
----

[[aggregating]]
== 聚合

`dataGrid` 可以对行内值进行聚合。

[[type]]
支持下列运算：

* `SUM` - 求和；
* `AVG` - 求平均；
* `COUNT` - 计算总数；
* `MIN` - 最小值；
* `MAX` - 最大值。

[[aggregatable]]
如需启用数据网格的聚合功能，需要：

. 设置 `aggregatable` 属性为 `true`。
. 为需要进行聚合运算的列设置 `aggregation` 元素。
. 设置 `aggregation` 元素的 `type` 属性，定义聚合运算的类型。

TIP: Jmix Studio 中可以定义聚合，在 XML 或 *Jmix UI* 层级面板中选择需要聚合的列，然后点击属性面板中的 *Add→Aggregation* 按钮。

聚合值在附加的新一行中显示。

[[aggregationPosition]]
`aggregationPosition` 属性可以定义附加聚合行的位置：`TOP` 或 `BOTTOM`。默认为 `BOTTOM`。

示例：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/datagrid/data-grid-view.xml[tags=aggregatable-dataGrid]
----
<1> `cellTitle` 属性定义当用户光标悬停至聚合值时需要显示的提示信息。
<2> 可以通过 xref:flow-ui:vc/miscellaneous/formatter.adoc[formatter] 设置该数据类型自定义的显示格式。

`aggregation` 元素还有 `strategyClass` 属性，可以指定实现 `AggregationStrategy` 接口的类。

[source,xml,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/datagrid/DataGridUserStatusAggregation.java[tags=aggregatable-grid]
----

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/datagrid/data-grid-view.xml[tags=aggregatable-grid]
----

== XML 属性

xref:vc/common-attributes.adoc#id[id] -
xref:vc/common-attributes.adoc#alignSelf[alignSelf] -
<<allRowsVisible,allRowsVisible>> -
xref:vc/common-attributes.adoc#classNames[classNames] -
xref:vc/common-attributes.adoc#colspan[colspan] -
<<columnReorderingAllowed,columnReorderingAllowed>> -
xref:vc/common-attributes.adoc#css[css] -
xref:vc/common-attributes.adoc#dataContainer[dataContainer] -
<<detailsVisibleOnClick,detailsVisibleOnClick>> -
<<dropMode,dropMode>> -
<<editorBuffered,editorBuffered>> -
xref:vc/common-attributes.adoc#enabled[enabled] -
xref:vc/common-attributes.adoc#height[height] -
xref:vc/common-attributes.adoc#maxHeight[maxHeight] -
xref:vc/common-attributes.adoc#maxWidth[maxWidth] -
xref:vc/components/entityPicker.adoc#metaClass[metaClass] -
xref:vc/common-attributes.adoc#minHeight[minHeight] -
xref:vc/common-attributes.adoc#minWidth[minWidth] -
<<multiSort,multiSort>> -
<<multiSortOnShiftClickOnly,multiSortOnShiftClickOnly>> -
<<multiSortPriority,multiSortPriority>> -
<<nestedNullBehavior,nestedNullBehavior>> -
<<pageSize,pageSize>> -
<<rowDraggable,rowDraggable>> -
<<selectionMode,selectionMode>> -
xref:vc/common-attributes.adoc#tabIndex[tabIndex] -
xref:vc/common-attributes.adoc#themeNames[themeNames] -
xref:vc/common-attributes.adoc#visible[visible] -
xref:vc/common-attributes.adoc#width[width]

[[allRowsVisible]]
=== allRowsVisible

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/grid/#dynamic-height" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

如果 `allRowsVisible` 属性设置为 `true`，数据网格的高度由数据行数决定。会从 `DataProvider` 中读取所有数据并展示，`dataGrid` 不带垂直滚动条。

NOTE: `allRowsVisible = true` 会禁用数据网格的垂直滚动条，所有数据会一次性在 DOM 渲染。如果数据网格有大量数据，会有性能问题，不推荐使用该功能。

[[columnReorderingAllowed]]
=== columnReorderingAllowed

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/grid/#column-reordering-resizing" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

`dataGrid` 提供拖放功能，支持用户调整数据网格中的列顺序。

列重排的功能默认是关闭的。需要设置 `columnReorderingAllowed = true` 开启。

列重排可以通过事件 <<ColumnReorderEvent>> 跟踪。

[[detailsVisibleOnClick]]
=== detailsVisibleOnClick

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/grid/#item-details" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

设置是否可以通过点击行打开或关闭条目详情。

[[dropMode]]
=== dropMode

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/grid/#drag-drop" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

设置拖放时的放置模式。当设置为非 `null` 时，`dataGrid` 会在数据放置到数据网格或某一行是发送事件。

支持四种不同的放置模式：`BETWEEN`、`ON_TOP`、`ON_TOP_OR_BETWEEN`、`ON_GRID`。

[[editorBuffered]]
=== editorBuffered

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/grid/#inline-editing-java-only" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

设置 `Editor` 的缓存模式。当编辑器使用缓存模式时，只有当用户点击保存按钮时才会提交改动。在非缓存模式时，改动会自动提交。

参考 <<inline-editing,行内编辑>>。

// [[multiSort]]
// === multiSort
//
// ++++
// <div class="jmix-ui-live-demo-container">
//     <a href="https://vaadin.com/docs/latest/components/grid/#sorting-by-multiple-columns" class="vaadin-docs-btn" target="_blank">Vaadin</a>
// </div>
// ++++
//
// Sets whether multiple column sorting is enabled on the client-side.

[[nestedNullBehavior]]
=== nestedNullBehavior

设置当解析可能包含 `null` 值的内部属性时的行为。

[[pageSize]]
=== pageSize

设置每页展示的行数，这个数值也是每次从数据提供器中获取的数量。参考 `com.vaadin.flow.component.grid.Grid.setPageSize()` 方法。

默认值：`50`。

[[rowDraggable]]
=== rowDraggable

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/grid/#row-reordering" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

设置用户是否可以拖放网格的行。

[[selectionMode]]
=== selectionMode

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/grid/#selection" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

设置数据网格的选择模式。

支持两种模式：`SINGLE` 和 `MULTI`。默认使用单选模式。

== 事件和处理器

xref:vc/common-handlers.adoc#AttachEvent[AttachEvent] -
xref:vc/common-handlers.adoc#BlurEvent[BlurEvent] -
<<CellFocusEvent,CellFocusEvent>> -
<<ColumnReorderEvent,ColumnReorderEvent>> -
<<ColumnResizeEvent,ColumnResizeEvent>> -
xref:vc/common-handlers.adoc#DetachEvent[DetachEvent] -
xref:vc/common-handlers.adoc#FocusEvent[FocusEvent] -
<<GridDragEndEvent,GridDragEndEvent>> -
<<GridDragStartEvent,GridDragStartEvent>> -
<<GridDropEvent,GridDropEvent>> -
<<ItemClickEvent,ItemClickEvent>> -
<<ItemDoubleClickEvent,ItemDoubleClickEvent>> -
<<SortEvent,SortEvent>> -
<<classNameGenerator,classNameGenerator>> -
<<dataGenerator,dataGenerator>> -
<<dragFilter,dragFilter>> -
<<dropFilter,dropFilter>>

include::../handler-generation-tip.adoc[]

[[CellFocusEvent]]
=== CellFocusEvent

当数据网格的某个单元格获得焦点时，发送 `com.vaadin.flow.component.grid.CellFocusEvent`。对应 `grid-cell-focus` DOM 事件。

[[ColumnReorderEvent]]
=== ColumnReorderEvent

当数据网格的列重排时，发送 `com.vaadin.flow.component.grid.ColumnReorderEvent`。对应 `column-reorder-all-columns` DOM 事件。

[[ColumnResizeEvent]]
=== ColumnResizeEvent

当用户改变数据网格列大小时，发送 `com.vaadin.flow.component.grid.ColumnResizeEvent`。对应 `column-drag-resize` DOM 事件。

[[GridDragEndEvent]]
=== GridDragEndEvent

当数据网格的行拖放结束时，发送 `com.vaadin.flow.component.grid.dnd.GridDragEndEvent`。对应 `grid-dragend` DOM 事件。

[[GridDragStartEvent]]
=== GridDragStartEvent

当数据网格的行拖放开始时，发送 `com.vaadin.flow.component.grid.dnd.GridDragStartEvent`。对应 `grid-dragstart` DOM 事件。

[[GridDropEvent]]
=== GridDropEvent

当拖放事件发生在数据网格或数据行时，发送 `com.vaadin.flow.component.grid.dnd.GridDropEvent`。对应 `grid-drop` DOM 事件。

[[ItemClickEvent]]
=== ItemClickEvent

当点击数据网格时，发送 `com.vaadin.flow.component.grid.ItemClickEvent`。对应 `item-click` DOM 事件。

[[ItemDoubleClickEvent]]
=== ItemDoubleClickEvent

当双击数据网格时，发送 `com.vaadin.flow.component.grid.ItemDoubleClickEvent`。对应 `item-double-click` DOM 事件。

[[SortEvent]]
=== SortEvent

`com.vaadin.flow.data.event.SortEvent` - 描述 `DataProvider` 中排序变化的事件。由 `SortNotifiers` 触发。

[[classNameGenerator]]
=== classNameGenerator

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/grid/#styling-rows-columns" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

`classNameGenerator` 用来为单元格生成 CSS 类名。

[[dataGenerator]]
=== dataGenerator

为数据网格添加数据生成器。如果已经添加，则不做操作。参考 `com.vaadin.flow.data.provider.HasDataGenerators` 接口。

[[dragFilter]]
=== dragFilter

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/grid/#drag-and-drop-filters" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

为拖放源设置拖动过滤器。
当 <<rowDraggable,rowDraggable = true>> 时，默认所有可见行都可以拖动。
可以用拖动过滤器指定哪些行支持拖动。该方法接收某一行数据作为输入，如果该行支持拖动，则返回 `true`。参考 `com.vaadin.flow.component.grid.Grid`。

[[dropFilter]]
=== dropFilter

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/grid/#drag-and-drop-filters" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

为拖放目标设置放置过滤器。

当数据网格的 <<dropMode,放置模式>> 设置为 `BETWEEN`、`ON_TOP` 或 `ON_TOP_OR_BETWEEN` 之一时，默认所有可见行的位置都可以放置。
可以用放置过滤器指定哪些行支持放置。该方法接收某一行数据作为输入，如果该行支持放置，则返回 `true`。参考 `com.vaadin.flow.component.grid.Grid`。

== XML 内部元素

<<actions,actions>> -
<<columns,columns>>

== 参考

{vaadin-docs}/components/grid[Vaadin 文档^]
