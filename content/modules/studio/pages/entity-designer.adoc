= Дизайнер сущностей

Studio предоставляет визуальный дизайнер для упрощенного создания xref:data-model:entities.adoc[сущностей], поэтому вам не нужно запоминать все правила и аннотации.

include::subscription-note.adoc[]

[[jpa-entity-designer]]
== Дизайнер сущностей JPA

Чтобы создать сущность, используйте меню в xref:studio:tool-window.adoc[Окне инструментов Jmix].

image::new.png[align="center",width="278"]

Появится диалог *New JPA Entity*.

image::entity-create.png[align="center",width="503"]

Заполните следующие поля:

* *Class* - имя нового класса. Оно должно соответствовать требованиям к именам Java.
* *Package* - пакет, в котором будет находиться класс. Значение по умолчанию автоматически отображается в поле. Вы можете изменить его, и Studio создаст пакет после нажатия *OK*.
* *Entity type* - выберите тип сущности:
** *Entity* - класс для xref:data-model:entities.adoc#jpa[сущности] модели данных.
** *MappedSuperclass* - базовый суперкласс, который не связан ни с какой конкретной таблицей базы данных. Такой класс сущностей аннотируется xref:data-model:entities.adoc#mapped-superclass[@MappedSuperclass].
** *Embeddable* - встраиваемая персистентная сущность. Такой класс сущности аннотируется `@Embeddable`.
* *Parent* - класс, от которого будет наследовать ваш новый класс.
* *Id type* - выберите тип первичного ключа объекта:
** `UUID` - идентификатор типа `UUID`.
** `Long` - идентификатор типа `Long`. Настоятельно рекомендуется добавить xref:data-model:entities.adoc#has-uuid-trait[черту] *UUID*, поскольку она обеспечивает дополнительную оптимизацию и позволяет однозначно идентифицировать ваши экземпляры в распределенной среде.
** `Integer` - идентификатор типа `Integer`. Настоятельно рекомендуется добавить черту *UUID*, поскольку она обеспечивает дополнительную оптимизацию и позволяет однозначно идентифицировать ваши экземпляры в распределенной среде.
** `String` - идентификатор типа `String`. Настоятельно рекомендуется добавить черту *UUID*, поскольку она обеспечивает дополнительную оптимизацию и позволяет однозначно идентифицировать ваши экземпляры в распределенной среде. Конкретный класс сущностей должен иметь строгое поле, аннотированное аннотацией JPA `@Id`.
** `Embedded` -  первичный ключ является составным ключом. В этом случае конкретный класс сущностей имеет поле встраиваемого типа, представляющее ключ, аннотированное JPA `@EmbeddedId`.
* *Id value* - в случае типа идентификатора `UUID` это поле включено и имеет значение *Generated By Jmix*. В общем случае выпадающий список *Id value* имеет следующие значения:
** *Generated By Jmix*. Идентификатор сущности аннотирован xref:data-model:entities.adoc#jmix-generated-value[@JmixGeneratedValue].
** *Identity column* подходит только для типов идентификаторов `Integer` и `Long`. Идентификатор сущности имеет аннотацию JPA `@GeneratedValue` со стратегией `GenerationType.IDENTITY`. Значение столбца *Identity column* используется для автоматически увеличиваемых идентификаторов. Настоятельно рекомендуется добавить черту *UUID*, поскольку она обеспечивает дополнительную оптимизацию и позволяет однозначно идентифицировать ваши экземпляры в распределенной среде.
** *Assigned by user* - идентификатор устанавливается пользователем. Подходит для типов идентификаторов `Integer`,  `Long`, `String`, и `Embedded` .
* *Id length* отображается, если выбран тип идентификатора `String`. Укажите максимальное количество символов. Значение по умолчанию – `255`.
* *Composite id type* отображается, если выбран тип идентификатора `Embedded` Выберите встраиваемую сущность, представляющую собой составной ключ.
* В группе флажков *Traits* выберите необходимые xref:data-model:entities.adoc#traits[черты].

Затем нажмите *OK*.

[[entity-editor]]
Studio отображает в редакторе три вкладки. Вместе они образуют визуальный Дизайнер сущностей:

* *Text* содержит исходный код сущности.
* *Designer* показывает структуру сущности. Вы можете добавлять атрибуты сущности, задавать имя экземпляра, xref:data-model:entities.adoc#inheritance[стратегию наследования] и валидацию с помощью графического интерфейса вместо написания кода Java.
* *Indexes* отображает индексы и позволяет создавать новые.

[[actions-panel]]
=== Панель действий

Панель действий расположена в верхней части дизайнера сущностей. Она предоставляет доступ к следующим действиям:

* *Views* - переходит к существующим экранам или создает xref:studio:screen-wizard.adoc[новые экраны] для текущей сущности.
+
image::entity-designer-create-screen.png[align="center",width="720"]
* *Event Listeners* - переходит к существующим xref:data-access:entity-events.adoc[слушателям событий] или создает новый для текущей сущности:
+
image::entity-designer-create-listener.png[align="center",width="703"]
* *Lifecycle Callbacks* - добавляет заглушки методов обратных вызовов жизненного цикла:
+
image::entity-designer-lifecycle-callbacks.png[align="center",width="163"]

[[entity-designer-designer]]
=== Вкладка Designer

Вкладка *Designer* показывает структуру сущности:

image::entity-designer-designer.png[align="center",width="969"]

В дополнение к полям, описанным в диалоговом окне <<jpa-entity-designer,Дизайнера сущностей JPA>>, вкладка *Designer* содержит следующие поля:

* Выпадающий список <<creating-instance-name, Instance name>>.
* Флажок *DB view*. Используя этот флажок, вы можете сопоставить сущность JPA с представлением базы данных. Такой класс сущностей аннотируется xref:data-model:entities.adoc#db-view[@DbView].
* Кнопка-ссылка *DDL Generation Settings* открывает визуальный конструктор значения аннотации xref:data-model:entities.adoc#ddl-generation[@DdlGeneration]:
+
image::ddl-generation.png[align="center",width="516"]
* Кнопка-ссылка *Traits* открывает диалоговое окно, содержащее xref:data-model:entities.adoc#traits[черты]:
+
image::traits.png[align="center",width="319"]
* В выпадающем списке *Inheritance* вы можете выбрать стратегию xref:data-model:entities.adoc#inheritance[наследования].
* С помощью редактируемой ссылки *Comment* вы можете добавлять xref:data-model:entities.adoc#comment[комментарии] к сущности.

Панель *Attributes* содержит действия для управления атрибутами сущности:

* Кнопка *Add* (image:icons/add.svg[]) открывает диалоговое окно <<adding-attributes,New Attribute>>.
* Нажмите кнопку *Copy* (image:icons/copy.svg[]), чтобы создать копию существующего атрибута.
* Кнопка *Add to Views* (image:icons/add-attribute-to-screens.svg[]) открывает диалоговое окно со всеми экранами, отображающими текущую сущность. Выберите экраны, на которых будет отображаться выбранный атрибут.
+
image::attributes-collection-modified.png[align="center",width="561"]
* Нажмите кнопку *Remove* (image:icons/remove.svg[]), чтобы удалить выбранный атрибут.
* Используйте кнопки *Up* (image:icons/move-up.svg[]) / *Down* (image:icons/move-down.svg[]), чтобы изменить порядок атрибутов.

На правой панели дизайнера сущностей отображаются свойства выбранного атрибута:

* Используйте кнопку глобуса (image:icons/globe.svg[]) рядом с полем *Name*, чтобы задать удобное для пользователей имя атрибута.
* Выпадающие списки *Attribute type* и *Type* позволяют выбрать xref:data-model:entities.adoc#attributes[тип атрибута сущности].
* С помощью редактируемой ссылки *Comment* вы можете добавлять xref:data-model:entities.adoc#comment[комментарии] к атрибуту сущности.

Панель *Validation* используется для определения ограничений xref:data-model:bean-validation.adoc[Bean Validation]. Нажмите на кнопку-ссылкe рядом с выбранным ограничением. Откроется редактор ограничений:

image::email-validation.png[align="center",width="691"]

[[entity-designer-text]]
=== Вкладка Text

На вкладке *Text* вы можете увидеть результирующий класс сущностей, созданный дизайнером.

image::entity-designer-text.png[align="center",width="840"]

Если у вас есть опыт работы с JPA, вы увидите знакомые аннотации: `@Entity`, `@Table`, `@Column` и т.д. Есть также несколько аннотаций, специфичных для Jmix. Наиболее важной из них является xref:data-model:entities.adoc#jmix-entity[@JmixEntity] в заголовке класса. В целом, любой POJO может быть сущностью в Jmix, если аннотирован `@JmixEntity`.

Класс сущности можно редактировать вручную, и если вернуться на вкладку *Designer*, в ней будут отражены изменения. Например, если вы удалите `nullable = false` и `@NotNull` из атрибута, дизайнер снимет для него флажок *Mandatory*.

Панель действий расположена в верхней части редактора исходного кода. Следующие действия добавляются к <<actions-panel,описанным выше>>:

* *Add Attribute* - открывает диалоговое окно <<adding-attributes,New Attribute>>.
* *Add Attributes to Views* - открывает диалоговое окно *Add Attributes to Views* со всеми экранами, отображающими текущую сущность. Выберите атрибуты, которые должны быть добавлены к экранам.
+
image::add-attribute-to-views.png[align="center",width="559"]

[[entity-designer-indexes]]
=== Вкладка Indexes

Вкладка *Indexes* используется для определения xref:data-model:entities.adoc#uniqueness[уникальных индексов].

image::entity-designer-index.png[align="center",width="840"]

Чтобы создать новый индекс, нажмите кнопку *New Index* (image:icons/add.svg[]) на панели инструментов *Database Indexes*. Studio добавит строку в список индексов.

Выберите атрибут сущности или набор атрибутов в списке *Available attributes* и щелкните по стрелке image:icons/arrow-right.svg[], чтобы переместить его в *Selected attributes*.

Установите флажки *Unique* и/или *Constraint* в строке индекса.


[[adding-attributes]]
== Добавление атрибутов

Вы можете добавить атрибут, нажав кнопку *Add* (image:icons/add.svg[]) на вкладке *Designer*, и настроить его в появившемся диалоговом окне. В приведенном ниже примере добавлен атрибут `addresses` с `ASSOCIATION` в поле *Attribute type*. В этом случае для xref:data-model:entities.adoc#references[ссылки] "один-ко-многим" необходимо создать обратный атрибут в сущности `Address`.

image::entity-association.png[align="center",width="862"]

Кнопка со значком глобуса в правой части поля *Name* позволяет сразу же задать удобное для пользователя имя атрибута. Оно хранится в файле `messages.properties` и используется по умолчанию в компонентах UI.

image::entity-message.png[align="center",width="818"]

Кроме того, вы можете вызвать диалоговое окно создания атрибута на вкладке *Text*, нажав кнопку *Add Attribute* на верхней панели или во всплывающем окне *Generate*.

image::entity-generate.png[align="center",width="840"]

[[creating-instance-name]]
== Создание имени экземпляра

Studio автоматически задает xref:data-model:entities.adoc#instance-name[имя экземпляра] для сущности, когда к ней добавляется атрибут с одним из следующих имен: `name`, `title`, `caption`, `label`, `summary`, `description`, `firstName`, `lastName`, `middleName`.

Если вы хотите задать другие атрибуты для генерации имени экземпляра, используйте визуальный конструктор. Его можно открыть нажав кнопку со значком карандаша в поле *Instance name*.

image::entity-instance-editor.png[align="center",width="814"]

Имя экземпляра также можно создать на вкладке *Text*. Наведите курсор на имя класса, нажмите *Alt+Enter* (⌥↩) и выберите *Add instance name*.

image::entity-instance-text.png[align="center",width="814"]

[[dto-designer]]
== Дизайнер сущностей DTO

Чтобы создать xref:data-model:entities.adoc#dto[сущность DTO], нажмите *New* (image:icons/add.svg[]) → *DTO Entity* в *Jmix Tool Window*. Появится диалоговое окно *New DTO Entity*.

image::dto-entity.png[align="center",width="489"]

Отображаемые поля аналогичны полям <<jpa-entity-designer,сущности JPA>>. Заполните их и нажмите *OK*.

Studio отображает две вкладки для созданной сущности.

* *Text* содержит исходный код сущности DTO.
* *Designer* показывает структуру сущности.

[[enumerations]]
== Перечисления

Studio помогает работать с перечислениями, предоставляя набор действий и визуальный конструктор. Чтобы создать xref:data-model:enumerations.adoc[перечисление], нажмите *New* (image:icons/add.svg[]) → *Enumeration* в окне инструментов *Jmix*.

После создания перечисления его класс будет открыт в редакторе с двумя вкладками.

image::entity-enum-editor.png[align="center",width="451"]

* *Text* содержит исходный код.
* *Designer* показывает дизайнер перечислений, в котором вы можете настроить перечисление и его значения с помощью графического интерфейса вместо написания кода Java.

Используйте таблицу *Values* и связанные с ней кнопки для настройки констант перечисления.

* Колонка *Name* позволяет ввести имя константы перечисления, которое будет использоваться в коде. Его можно переименовать позже, не затрагивая существующие данные в базе данных.
* Колонка *Value* позволяет ввести идентификатор константы перечисления. Это фактическое значение, хранящееся в базе данных.

Кнопка глобуса позволяет задать локализованные надписи для выбранной константы перечисления.

Дизайнер также предоставляет возможность изменять тип идентификатора, используемый перечислением, со `String` на `Integer` и наоборот. Studio мигрирует используемые перечисления в коде. После этого вам нужно изменить значения существующих констант перечисления.

[NOTE]
====
Такая миграция не переносит значения перечисления, уже сохраненные в таблицах базы данных; вам будет нужно реализовать такую миграцию самостоятельно.
====