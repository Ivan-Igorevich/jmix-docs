= Экраны

_Экран_ (view) — это базовый строительный блок пользовательского интерфейса приложения. Он является корнем иерархии визуальных компонентов, кроме того, он может содержать компоненты данных, действия и фасеты.

Экран определяется классом Java. Класс экрана обычно имеет соответствующий XML-файл, называемый _дескриптором_, который определяет содержимое экрана. Таким образом, существует четкое разделение между декларативной компоновкой элементов экрана, определенной в XML, и логикой программной инициализации и обработки событий, написанной на Java.

[[view-classes]]
== Классы экранов

Jmix предоставляет следующие базовые классы экранов:

image::views/views-diagram.svg[align="center"]

[[view]]
=== View

Класс `View` определяет состояние и поведение всех разновидностей экранов.

[[standard-main-view]]
=== StandardMainView

`StandardMainView` - это корневой экран приложения, который открывается после входа пользователя в систему. Он содержит компонент  {vaadin-docs}/components/app-layout[AppLayout^] с главным меню.

image::views/main-view-1.png[align="center"]

[[standard-view]]
=== StandardView

`StandardView` является базовым классом для обычных экранов. Такие экраны могут отображаться либо внутри основного экрана с помощью навигации на URL экрана, либо во всплывающем диалоговом окне.

Ниже приведен стандартный экран, открытый с использованием URL `/my-onboarding`:

image::views/standard-view-1.png[align="center"]

[[standard-list-view]]
=== StandardListView

`StandardListView` - это базовый класс для экранов CRUD, отображающих список сущностей. Его также можно использовать в качестве экрана поиска для выбора экземпляров сущностей из списка и возврата их вызывающему объекту. В представлении списка обычно используются компоненты xref:vc/components/dataGrid.adoc[] или xref:vc/components/treeDataGrid.adoc[].

Ниже представлен экран списка, открытый с использованием URL `/departments`:

image::views/list-view-1.png[align="center"]

Этот же экран, открытый в диалоге для выбора сущностей:

image::views/list-view-2.png[align="center"]

[[standard-detail-view]]
=== StandardDetailView

`StandardDetailView` - это базовый класс для экранов CRUD, отображающих один экземпляр сущности. Экран деталей обычно использует компонент xref:vc/layouts/formLayout.adoc[].

Ниже приведен экран деталей, открытый с использованием идентификатора объекта в URL:

image::views/detail-view-1.png[align="center"]

Тот же экран, открытый в диалоговом окне:

image::views/detail-view-2.png[align="center"]

[[view-annotations]]
== Аннотации экранов

Аннотации на классах экранов предоставляют информацию об экранах фреймворку. Некоторые аннотации применимы к любому типу экрана, некоторые из них можно использовать только в экранах списков или деталей сущностей.

[[common-annotations]]
=== Общие аннотации

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/myonboarding/MyOnboardingView.java[tags=annotations]
----

* `@ViewController` указывает, что класс является экраном. Значением аннотации является идентификатор экрана, который можно использовать для ссылки на экран из xref:menu-config.adoc[главного меню] или при программном открытии экрана.

* `@ViewDescriptor` соединяет класс экрана с его XML-дескриптором. Значение аннотации указывает путь к файлу дескриптора. Если значение содержит только имя файла, предполагается, что файл находится в том же пакете, что и класс экрана.

* `@com.vaadin.flow.router.Route` определяет URL-путь для перехода к этому экрану. Поскольку экран должен открываться внутри основного экрана, `layout` атрибут указывает класс основного экрана.

* `@DialogMode` определяет параметры диалогового окна, когда экран открывается как диалог.

[[list-view-annotations]]
=== Аннотации экранов списка

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/department/DepartmentListView.java[tags=annotations]
----

* `@LookupComponent` указывает идентификатор компонента UI, который будет использоваться для получения значения, возвращаемого в результате поиска.

* `@PrimaryLookupView` указывает, что этот экран является экраном поиска по умолчанию для указанной сущности. Аннотация имеет больший приоритет, чем xref:opening-views.adoc#view-inference-conventions[соглашение] `\{entity_name}.lookup` / `\{entity_name}.list`.

[[detail-view-annotations]]
=== Аннотации экранов деталей

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/department/DepartmentDetailView.java[tags=annotations]
----

* `@EditedEntityContainer` указывает контейнер данных, содержащий редактируемую сущность.

* `@PrimaryDetailView` указывает, что этот экран является экраном деталей по умолчанию для указанной сущности. Аннотация имеет больший приоритет, чем xref:opening-views.adoc#view-inference-conventions[соглашение] `\{entity_name}.detail`.

//[[events]]
//== View Events
//
//This section describes the screen lifecycle events that can be handled in controllers.
//
//[[init-event]]
//=== InitEvent
//
//`InitEvent` is sent when the screen controller and all its declaratively defined components are created, and dependency injection is completed. Nested fragments are not initialized yet. Some visual components are not fully initialized, for example, buttons are not linked with actions.
//
//[source,java,indent=0]
//----
//include::example$/ex1/src/main/java/ui/ex1/screen/screens/OrderBrowse1.java[tags=init-event]
//----
//
//[[init-entity-event]]
//== InitEntityEvent
//
//`InitEntityEvent` is sent in screens inherited from `StandardEditor` and `MasterDetailScreen` before the new entity instance is set to edited entity container.
//
//Use this event listener to initialize default values in the new entity instance, for example:
//
//[source,java,indent=0]
//----
//include::example$/ex1/src/main/java/ui/ex1/screen/screens/OrderEdit1.java[tags=init-entity]
//----
//
//[[before-show-event]]
//== BeforeShowEvent
//
//`BeforeShowEvent` is sent right before the screen is shown, for example, it is not added to the application UI yet. Security restrictions are applied to UI components. In this event listener, you can load data, check permissions and modify UI components. For example:
//
//[source,java,indent=0]
//----
//include::example$/ex1/src/main/java/ui/ex1/screen/screens/OrderBrowse1.java[tags=before-show1;before-show2]
//----
//
//[[after-show-event]]
//== AfterShowEvent
//
//`AfterShowEvent` is sent right after the screen is shown, for example, when it is added to the application UI. In this event listener, you can show notifications, dialogs or other screens. For example:
//
//[source,java,indent=0]
//----
//include::example$/ex1/src/main/java/ui/ex1/screen/screens/OrderBrowse1.java[tags=after-show1;after-show2]
//----
//
//[[before-close-event]]
//== BeforeCloseEvent
//
//`BeforeCloseEvent` is sent right before the screen is closed by its `close(CloseAction)` method. The screen is still displayed and fully functional. In this event listener, you can check any conditions and prevent screen closing using the `preventWindowClose()` method of the event, for example:
//
//[source,java,indent=0]
//----
//include::example$/ex1/src/main/java/ui/ex1/screen/screens/OrderEdit1.java[tags=before-close1;before-close2]
//----
//
//The `Window` interface has also an event with the same name. It is sent before the screen is closed by an external (relative to the controller) action, like clicking on the button in the window tab or by pressing the *Escape* key. The way the window is closed can be obtained using the `getCloseOrigin()` method which returns a value implementing the `CloseOrigin` interface. Its default implementation `CloseOriginType` has three values:
//
//* `BREADCRUMBS` - the screen is closed by clicking on the breadcrumbs link.
//* `CLOSE_BUTTON` - the screen is closed by the close button in the window header or by the window tab close button or context menu actions: Close, Close All, Close Others.
//* `SHORTCUT` - the screen is closed by the keyboard shortcut defined in the xref:ui:app-properties.adoc#jmix.ui.screen.close-shortcut[jmix.ui.screen.close-shortcut] application property.
//
//You can subscribe to `Window.BeforeCloseEvent` by specifying `Target.FRAME` in the `@Subscribe` annotation:
//
//[source,java,indent=0]
//----
//include::example$/ex1/src/main/java/ui/ex1/screen/screens/OrderEdit3.java[tags=before-close]
//----
//
//[[after-close-event]]
//== AfterCloseEvent
//
//`AfterCloseEvent` is sent after the screen is closed by its `close(CloseAction)` method and after `Screen.AfterDetachEvent`. In this event listener, you can show notifications or dialogs after closing the screen, for example:
//
//[source,java,indent=0]
//----
//include::example$/ex1/src/main/java/ui/ex1/screen/screens/OrderEdit3.java[tags=after-close1;after-close2]
//----
