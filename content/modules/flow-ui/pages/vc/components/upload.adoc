= upload 上传

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/ui-samples/sample/upload" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

`upload` 支持用户上传文件。能显示上传进度以及每个文件的状态。文件可以通过点击 *Upload files（上传文件）* 按钮或者拖拽的方式上传。

* XML 元素：`upload`

* Java 类：`JmixUpload`

== 基本用法

`upload` 的示例：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/upload/upload-view.xml[tags=basics]
----

image::visual-components/components/upload-basics.png[align="center", width="332"]

== XML 属性

xref:vc/common-attributes.adoc#id[id] -
xref:flow-ui:vc/components/fileStorageUploadField.adoc#acceptedFileTypes[acceptedFileTypes] -
xref:vc/common-attributes.adoc#alignSelf[alignSelf] -
<<autoUpload,autoUpload>> -
xref:vc/common-attributes.adoc#classNames[classNames] -
xref:vc/common-attributes.adoc#colspan[colspan] -
xref:vc/common-attributes.adoc#css[css] -
xref:flow-ui:vc/components/fileStorageUploadField.adoc#dropAllowed[dropAllowed] -
<<dropLabel,dropLabel>> -
<<dropLabelIcon,dropLabelIcon>> -
xref:vc/common-attributes.adoc#height[height] -
xref:flow-ui:vc/components/fileStorageUploadField.adoc#maxFileSize[maxFileSize] -
<<maxFiles,maxFiles>> -
xref:vc/common-attributes.adoc#maxHeight[maxHeight] -
xref:vc/common-attributes.adoc#maxWidth[maxWidth] -
xref:vc/common-attributes.adoc#minHeight[minHeight] -
xref:vc/common-attributes.adoc#minWidth[minWidth] -
<<receiverFqn,receiverFqn>> -
<<receiverType,receiverType>> -
xref:flow-ui:vc/components/fileStorageUploadField.adoc#uploadIcon[uploadIcon] -
xref:flow-ui:vc/components/fileStorageUploadField.adoc#uploadText[uploadText] -
xref:vc/common-attributes.adoc#visible[visible] -
xref:vc/common-attributes.adoc#width[width]

[[autoUpload]]
=== autoUpload

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/upload#auto-upload" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

设置组件是否在选择了文件之后立刻上传。

当设置为 `false` 时，则添加文件后不会立刻上传。

默认值为 `true`。

[[dropLabel]]
=== dropLabel

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/upload#customization" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

设置组件中引导用户拖放文件的文本。

该属性的值可以是一个纯文本，或 xref:localization:message-bundles.adoc[消息包] 中的一个键值。如果是键值，需要以 `msg://` 开头。

[[dropLabelIcon]]
=== dropLabelIcon

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/upload#customization" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

设置引导用户拖放文件的图标。

[[maxFiles]]
=== maxFiles

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/upload#file-count" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

设置允许用户上传的最大文件个数，默认无限制。如果设置为 1，则系统原生的文件选择器将不允许选择多个文件。

默认不会在 UI 显示文件上传的异常。请使用 <<FileRejectedEvent,FileRejectedEvent>> 捕捉异常，然后可以使用通知为用户展示异常。

[[receiverFqn]]
=== receiverFqn

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/upload#handling-uploaded-files-java-only" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

设置一个接收器（`Receiver`）的实现，用于接收 `upload` 组件上传的文件。

NOTE: 如果接收器未实现 `MultiFileReceiver`，则 `upload` 组件自动设置为仅接受单文件上传。

[[receiverType]]
=== receiverType

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/upload#handling-uploaded-files-java-only" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

指定 `Receiver` 实现的类型。支持：

* `MemoryBuffer`
+
一次只处理单个文件上传。将文件数据写入内存中。使用 `MemoryBuffer` 时，会自动将组件配置成仅能选择单文件上传。
* `MultiFileMemoryBuffer`
+
处理多个文件上传。将文件数据写入内存中。
* `FileTemporaryStorageBuffer`
+
一次只处理单个文件上传。将文件保存至 xref:files:file-storage.adoc[临时文件存储]。使用 `FileTemporaryStorageBuffer` 时，会自动将组件配置成仅能选择单文件上传。
* `MultiFileTemporaryStorageBuffer`
+
处理多个文件上传。将文件数据写入内存中。将文件保存至 xref:files:file-storage.adoc[临时文件存储]。

默认接收类型为 `MemoryBuffer`。

== 事件和处理器

<<AllFinishedEvent,AllFinishedEvent>> -
xref:vc/common-handlers.adoc#AttachEvent[AttachEvent] -
xref:vc/common-handlers.adoc#DetachEvent[DetachEvent] -
<<FailedEvent,FailedEvent>> -
<<FileRejectedEvent,FileRejectedEvent>> -
<<FinishedEvent,FinishedEvent>> -
<<ProgressUpdateEvent,ProgressUpdateEvent>> -
<<StartedEvent,StartedEvent>> -
<<SucceededEvent,SucceededEvent>> -
<<receiver,receiver>>

include::../handler-generation-tip.adoc[]

[[AllFinishedEvent]]
=== AllFinishedEvent

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/upload#listeners" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

`com.vaadin.flow.component.upload.AllFinishedEvent` 当 `upload` 组件处理完队列中所有的文件之后发送，无论上传是否成功。

[[FailedEvent]]
=== FailedEvent

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/upload#listeners" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

`com.vaadin.flow.component.upload.FailedEvent` 当 `upload` 组件上传的文件被接收但由于某些原因中断时发送。

[[FileRejectedEvent]]
=== FileRejectedEvent

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/upload#listeners" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

`com.vaadin.flow.component.upload.FileRejectedEvent` 当选择的文件不满足 `upload` 的要求时发送，例如，xref:flow-ui:vc/components/fileStorageUploadField.adoc#maxFileSize[文件大小限制] 或 <<maxFiles,文件数量限制>>。

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/upload/UploadView.java[tags=notifications;FileRejectedEvent]
----

[[FinishedEvent]]
=== FinishedEvent

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/upload#listeners" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

`com.vaadin.flow.component.upload.FinishedEvent` 当 `upload` 接收了文件后发送，不论是否成功。如需区别是否成功，请使用 <<SucceededEvent,SucceededEvent>> 或 <<FailedEvent,FailedEvent>>，这两个都是 `FinishedEvent` 的子类。

[[ProgressUpdateEvent]]
=== ProgressUpdateEvent

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/upload#listeners" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

`com.vaadin.flow.component.upload.ProgressUpdateEvent` 用于跟踪上传文件的进度。

[[StartedEvent]]
=== StartedEvent

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/upload#listeners" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

`com.vaadin.flow.component.upload.StartedEvent` 当组件开始接收文件时发送。

[[SucceededEvent]]
=== SucceededEvent

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/upload#listeners" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

`com.vaadin.flow.component.upload.SucceededEvent` 当组件成功接收文件时发送。

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/upload/UploadView.java[tags=notifications;SucceededEvent]
----

我们的示例应用程序中有一个 https://demo.jmix.io/ui-samples/sample/upload[例子^]，在 `com.vaadin.flow.component.upload.SucceededEvent` 中使用了 `MultiFileMemoryBuffer` 管理多个文件。

[[receiver]]
=== receiver

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/upload#handling-uploaded-files-java-only" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

设置 `upload` 组件使用的接收器。参考 <<receiverFqn>> 和 <<receiverType>> 属性。

== 参考

{vaadin-docs}/components/upload[Vaadin 文档^]
