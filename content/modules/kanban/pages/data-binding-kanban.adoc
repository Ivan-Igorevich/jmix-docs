= Bind Kanban to Data

In this chapter, you will create:

* The `TaskStatus` enumeration.
* The `KanbanTask` entity with the attributes required to be displayed on the Kanban board.
* CRUD views with a Kanban board on the `KanbanTask.list` view.

[[entity-and-view-creation]]
== Create KanbanTask Entity and Views

To start, you'll need to generate a `TaskStatus` enumeration consisting of the following values:

* `Todo`
* `In progress`
* `Verification`
* `Done`

The detailed instructions for creating enumerations can be found in the xref:tutorial:enumerations.adoc[Using Enumerations] section of Tutorial.

image::enumeration-task-status-type.png[align="center", width="591"]

Next, you can create the `KanbanTask` entity. You can find detailed instructions for creating entities in the xref:tutorial:simple-crud.adoc[Simple CRUD] section of the Tutorial.

The `KanbanTask` entity has the following attributes:

* `text` with `String` type. Select the *Mandatory* checkbox.
* `status` with `TaskStatus` enumeration type. Select the *Mandatory* checkbox.
* `assignee` with association to `User`, many-to-one cardinality.

image::assignee-attribute.png[align="center", width="617"]

Define the `text` attribute for generation an xref:studio:entity-designer.adoc#creating-instance-name[instance name].

Create detail view for the `KanbanTask` entity. You'll find the detailed steps for generating entity list and detail views in the xref:tutorial:simple-crud.adoc#create-views[Creating CRUD Views] section of the Tutorial.

Follow the suggested values at each step of the view creation wizard.

Studio will automatically generate `KanbanTask.detail`, and open the corresponding source code.

[[adding-kanban]]
== Add Kanban on View

You'll need to create a blank view with `KanbanTask.list` ID. This view will be used to add a Kanban board.

image::kanban-task-list-view-wizard.png[align="center", width="1318"]

Locate `kanban-task-list-view.xml` in the *Jmix* tool window and double-click it. The view designer will appear.
To start, you'll add a `collectionContainer` to load tasks from the database. The detailed instructions for defining Data Container can be found in the xref:tutorial:ui-from-scratch.adoc#define-data-container[Creating UI from Scratch] of Tutorial.

Click *Add Component* in the actions panel, then find the `CollectionContainer` item and double-click it:

image::create-kanban-task-collection-container.png[align="center", width="1318"]

In the dialog that opens, select the `KanbanTask` entity. The new `collectonContainer` element will be added in both the *Jmix UI* hierarchy panel and in the XML.

In order for the `dataLoader` to automatically load data when the view is opened, you need to add the `dataLoadCoordinator` facet. Click *Add Component* in the action panel, then find the `DataLoadCoordinator` item and double-click it:

image::create-data-load-coordinator.png[align="center", width="617"]

If you want to display a Kanban on the view, you should include the `kanban` UI component in the XML descriptor.

Place the cursor inside the `layout` element.

Next, click *Add Component* in the actions panel, then find the `Kanban` item and double-click it:

image::create-kanban-component.png[align="center", width="1318"]

Configure the `id`, `dataContainer`, `height` and `width` attributes as shown below.

[source,xml,indent=0]
----
<kanban:kanban id="kanban" dataContainer="kanbanTasksDc" width="100%" height="100%"/>
----

[[configuring-columns]]
=== Configuring Columns

To display the `Kanban` board component on the view, it is necessary to define columns. To do this, select `kanban` in the *Jmix UI* hierarchy panel or in the XML descriptor, then click the *Add* button in the component inspector panel. From the drop-down list, choose *Columns -> Column*.

image::create-kanban-column.png[align="center", width="331"]

In the dialog that opens, you'll define the mandatory column attribute `dataField`. This attribute is the identifier of the column in the `kanban` component. You need to define the column so that the values of the `dataField` attribute match the values of the `TaskStatus` enumeration. Also, you need to define the `label` attribute. The value of this attribute will be displayed in the column header.

image::configure-kanban-columns.png[align="center", width="1318"]

Now, you can run the application to see the new component in action.

Click the *Debug* button (image:start-debugger.svg[]) in the main toolbar.

Prior to launching the application, Studio compares the project data model with the database schema. When you've created a new entity, Studio automatically generates a Liquibase changelog to reflect the relevant database modifications (such as creating the `KANBAN_TASK` table):

image::changelog-kanban-task.png[align="center", width="1036"]

Click *Save and run*.

Studio will carry out the changelog on your database, followed by building and running the application:

image::run-app.png[align="center", width="1101"]

Once the application is up and running, navigate to http://localhost:8080 using your web browser and sign in to the application with the credentials admin/admin.

Choose the `Kanban Tasks` item from the `Application` menu. You will see the `KanbanTask.list` view. The view will open:

image::kanban-task-list.png[align="center', width="1134"]

[[adding-actions]]
=== Adding Actions
To provide the ability to create, edit and remove tasks, you need to add actions to the component.

Choose `kanban` within the *Jmix UI* hierarchy panel or in the view XML descriptor, and then click the *Add* button in the component inspector panel. From the drop-down list, opt for *Actions -> Action*.

image::create-kanban-actions.png[align="center", width="413"]

Specify the actions you want to add. For example: `list_create`, `list_edit`, `list_remove`.

image::create-kanban-actions2.png[align="center", width="563"]

Click the *Ok* button. The `action` elements will be added in both the *Jmix UI* hierarchy panel and in the XML. Next, to use these actions, you need to create buttons panel.

Place the cursor before the `kanban` element. Next, click *Add Component* in the actions panel, then find the `hbox` item and double-click it. To add the required styles, add the `classNames` attribute with the `buttons-panel` value to the `hbox`:

[source, xml, indent=0]
----
<hbox classNames="buttons-panel"/>
----

Choose `hbox` within the *Jmix UI* hierarchy panel or in the view XML descriptor, and then click the *Add Component* button in the actions  panel, then find the `button` item and double-click it.

Use the component inspector panel to assign an action to the `button`. Create and assign buttons for each action.

image::create-kanban-buttons.png[align="center", width="573"]

To make task editing more convenient, you'll need to open the detail views in dialog mode. To do this, select the `create` action in the *Jmix UI* hierarchy panel or in the XML descriptor, then change the open mode property to `DIALOG`.

image::create-kanban-actions3.png[align="center", width="410"]

Press *Ctrl/Cmd+S* and switch to the running application.

Choose the `Kanban Tasks` item from the `Application` menu. You can now create, edit and remove tasks using the detail view dialog:

image::task-entity-crud.png[align="center",width="2510"]

== Auto Data Saving
[[auto-data-saving]]

`kanban` component keep temporary changes in a data container until a confirmation action is triggered to commit them to the database. This behavior is typical for visual components.

To enable automatic saving of xref:flow-ui:data/data-context.adoc[DataContext], you can use the xref:kanban-component.adoc#autoSave[autoSave] attribute.

Choose `kanban:kanban` in the *Jmix UI* hierarchy panel or in the view XML descriptor, and then check the *autoSave* box in the inspector panel.

[NOTE]
====
Don't forget to remove the `readOnly="true"` attribute from the `loader`. Otherwise, the changes will not be saved to the database.
====

image::auto-data-saving.png[align="center",width="2346"]

Press *Ctrl/Cmd+S* and switch to the running application.

[[editing-double-click]]
== Editing by Double-clicking

Kanban supports event handling. For more information on available events, please refer to the xref:kanban-component.adoc#handlers[handlers] section.

In order to edit a Kanban task card by double-clicking, you need to implement a xref:kanban-component.adoc#KanbanTaskDoubleClickEvent[KanbanTaskDoubleClickEvent] handler.

Open the `KanbanTaskListView.java` class. To generate the handler method from scratch, click *Generate Handler* in the actions panel on top of the code editor:

image::generate-handlers.png[align="center",width="2182"]

Then select `KanbanTaskDoubleClickEvent` in the `Kanban` handlers section of the tree:

image::generate-task-double-click-handler.png[align="center",width="1974"]

Now you need to implement the logic for opening the detail view:

[source,java,indent=0]
----
include::../examples/kanban-ex1/src/main/java/com/company/onboarding/view/kanbantasklist/KanbanTaskListView.java[tags=dialogWindows;kanban;doubleClickHandler]
----

Press *Ctrl/Cmd+S* and switch to the running application. You can now edit the card by double-clicking.