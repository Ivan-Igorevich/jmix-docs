= 数据绑定

[[data-provider]]
== DataProvider

xref:chart-component.adoc#data-set[`dataSet`] 元素可以使用 `DataProvider` 的实现作为数据源。`DataProvider` 的实例通过图表组件的 `DataSet.Source` XML 元素传递到 `withDataProvider()` 方法中。

image::data-binding-diagram.png[align="center", width="1318"]

框架中有 `DataProvider` 接口的两个标准实现：`ListChartItems` 和 `ContainerChartItems` 类，使用时，需根据数据源的要求进行选择。

[[list-data-provider]]
=== ListChartItems

`ListChartItems` 可以支持为图表手动添加数据项，以展示非实体数据或动态组织的数据。

`ListChartItems` 的实现包含了一组 `DataItem` 实例的集合。`DataItem` 接口具有三种实现：

* `EntityDataItem` 包含任意实体实例，用于展示图表数据：
+
[source,java,indent=0]
----
include::example$charts-ex1/src/main/java/com/company/demo/view/dataitems/DataItemsView.java[tags=entityDataItems]
----

* `MapDataItem` 可以使用键值对数据作为图表数据源：
+
[source,java,indent=0]
----
include::example$charts-ex1/src/main/java/com/company/demo/view/dataitems/DataItemsView.java[tags=mapDataItems]
----

* `SimpleDataItem` 支持使用任何 `public` 类的实例定义图表数据：
+
[source,java,indent=0]
----
include::example$charts-ex1/src/main/java/com/company/demo/view/dataitems/DataItemsView.java[tags=simpleDataItems]
----

[[container-data-provider]]
=== ContainerDataItems

`ContainerDataItems` 用于为 `Chart` 组件分配一个 xref:flow-ui:data/collection-container.adoc[CollectionContainer]。这种方式要求使用已有实体表示图表数据。

例如，我们有一个数据容器加载了 `VehicleCount` 实例。下面是视图 XML 的相关代码：
[source,xml,indent=0]
----
include::example$charts-ex1/src/main/resources/com/company/demo/view/vehiclecount/vehicle-count-chart-view.xml[tags=dataCollection]
----

视图控制器中定义了 `onInit()` 方法，其中为图表设置一个基于 `vehiclesDc` 的 data provider。
[source,java,indent=0]
----
include::example$charts-ex1/src/main/java/com/company/demo/view/vehiclecount/VehicleCountChartView.java[tags=dataSet]
----

如需声明式绑定数据，可以用 XML xref:chart-component.adoc#data-set[`dataSet`] 中 `source` 的 `dataContainer` 属性：
[source,xml,indent=0]
----
include::example$charts-ex1/src/main/resources/com/company/demo/view/vehiclecount/vehicle-count-chart-view.xml[tags=dataSet]
----

[[gauge-series-data-binding]]
== 仪表盘的数据绑定
++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/ui-samples/sample/gauge-series-simple" class="live-demo-btn" target="_blank">LIVE DEMO</a>
</div>
++++

与其他图表不同，仪表盘（`gauge`）不支持 `DataSet`。

为 `gauge` 图表添加数据时，可以按照下面示例中的做法，在 XML 的 `series.data` 中定义 `dataItem` 元素：

[source,xml,indent=0]
----
include::example$charts-ex1/src/main/resources/com/company/demo/view/gauge/gauge-series-view.xml[tags=dataBinding]
----

或者，在 Java 控制器中，获取 `series` 属性，然后通过 `setData()` 方法编程式的绑定数据。

[source,java,indent=0]
----
include::example$charts-ex1/src/main/java/com/company/demo/view/gauge/GaugeSeriesView.java[tags=dataBinding]
----

NOTE: 仪表盘图中使用的 `DataItem` 对象与本节中其他的 `DataItem` 是不同的。
