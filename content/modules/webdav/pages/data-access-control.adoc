= 5. Data Access Control

So far you entered the application as admin and had full control over data and UI. In this final chapter, you will set up restricted access to the application for HR Managers and Employees.

[[employees-resource-role]]
== Resource Role for Employees

An employee needs to read the `WebdavDocumentWrapper` entity instances to view them in UI.

Double-click on *Security -> EmployeeRole* xref:security:resource-roles.adoc[resource role] in *Jmix tool* window.

Switch to the *User Interface* tab to define permissions to views. Select `WebdavDocumentWrapper.list` in the menu tree and select *Allow* checkboxes on the right:

image::employee-role.png[align="center", width="1007"]

After that, switch to the *Entities* tab and select the following permissions:

image::employee-role-2.png[align="center", width="1083"]

[[managers-resource-role]]
== Resource Role for HR Managers

HR managers need to upload documents, delete documents, and edit the content of documents.

Double-click on *Security -> HRManagerRole* xref:security:resource-roles.adoc[resource role] in *Jmix tool* window.

Switch to the *User Interface* tab and allow `WebdavDocumentWrapper.list`, and `WebdavDocumentWrapper.detail`.

image::hr-manager-role.png[align="center", width="946"]

Switch to the *Entities* tab.

Give all permissions to the `WebdavDocumentWrapper` entity.

image::hr-manager-role-2.png[align="center", width="946"]

[[webdav-document-restrictions-role]]
== Row-level WebDavDocumentsDepartmentRole

In this section, you will introduce a row-level role which restricts access to WebDAV documents for an employee.

If the employee has the role of _HR Manager_ or _Administrator_, then display all WebDAV documents.

If the employee has the role of _Employee_, display only WebDAV documents related to the employee's department.

In the *Jmix* tool window, click *New* (image:add.svg[]) -> *Row-level Role*. In the *New Row-level Role* dialog, enter:

* *Role name*: `WebDav documents department`
* *Role code*: `web-dav-documents-department`
* *Class*: `com.company.onboarding.security.WebDavDocumentsDepartmentRole`

Click *OK*.

Studio will create and open an annotated interface:

[source,java,indent=0]
----
@RowLevelRole(name = "WebDav documents department", code = WebDavDocumentsDepartmentRole.CODE)
public interface WebDavDocumentsDepartmentRole {
    String CODE = "web-dav-documents-department";
}
----

Add the following source code to the `WebDavDocumentsDepartmentRole` interface:

[source,java,indent=0]
----
include::example$/webdav-ex1/src/main/java/com/company/onboarding/security/WebDavDocumentsDepartmentRole.java[tags=role]
----

[[ui-based-restrictions]]
== Modifying the UI Based on Restrictions

Let's go back to the `WebdavDocumentWrapper.list` view and add logic to manage the accessibility of WevDAV document management buttons based on user roles.

[source,java,indent=0]
----
include::example$/webdav-ex1/src/main/java/com/company/onboarding/view/webdavdocumentwrapper/WebdavDocumentWrapperListView.java[tags=buttons-actions;customizing-ui]
----