= 图表组件

在项目中安装扩展组件后，即可在 Studio xref:studio:view-designer.adoc[] 的 *Add Component* 工具箱中使用 `Chart` 组件。创建图表支持两种方式：在 XML 中使用内部元素和属性，或者在 Java 中通过 API 配置。

下面的示例中，图表首先在 XML 中声明式配置：

[source,xml,indent=0]
----
include::example$charts-ex1/src/main/resources/com/company/demo/view/vehiclecount/vehicle-count-chart-view.xml[tags=chart]
----

然后，在 Java 中设置一些额外属性：

[source,java,indent=0]
----
include::example$/charts-ex1/src/main/java/com/company/demo/view/vehiclecount/VehicleCountChartView.java[tag=configure]
----

结果如下：

image::chart-component-1.png[align="center", width="675"]

如果没有 Studio 的视图设计器，可以在 XML 中手动添加 `charts` 命名空间：

[source,xml]
----
<view xmlns="http://jmix.io/schema/flowui/view"
      xmlns:charts="http://jmix.io/schema/charts/ui"/>
----

[TIP]
====
配置图表时，可以参考 https://echarts.apache.org/en/option.html#title[Apache ECharts 官方配置手册^] 找到需要配置的属性，然后使用对应的 Jmix Chart 属性。大多数情况下，JS 和 Java API 的配置是一样的。
====

// [TIP]
// ====
// To add any property in Jmix Studio, select the `chart` component in the screen descriptor XML or in the *Component Hierarchy* panel. Select the xref:studio:screen-designer.adoc#component-inspector-add-button[Add] option then choose the desired property in the *Component Inspector* panel.
// ====

[[data-set]]
== DataSet

++++
<div class="jmix-ui-live-demo-container">
<a href="https://echarts.apache.org/en/option.html#dataset" class="echarts-docs-btn" target="_blank">ECharts</a>
</div>
++++

`dataSet` 属性定义图表 <<series,series>> 的数据源。在一个 `charts` 标签中，数据源可以在多个 `series` 之间重用。

下面的示例中，在 XML 配置了一个数据集，将图表与 `vehiclesDc` 数据容器进行关联：

[source,xml,indent=0]
----
include::example$charts-ex1/src/main/resources/com/company/demo/view/vehiclecount/vehicle-count-chart-view.xml[tags=dataSet]
----

图表会使用实体的 `year` 属性作为分类名，以及 `cars`、`motorcycles` 和 `bicycles` 属性作为数值。

Java 中可以按如下代码配置相同的数据集：

[source,java,indent=0]
----
include::example$/charts-ex1/src/main/java/com/company/demo/view/vehiclecount/VehicleCountChartView.java[tag=dataSet]
----

NOTE: 一个 `chart` 元素只能包含一个 `dataSet` 配置。

[[series]]
== Series

++++
<div class="jmix-ui-live-demo-container">
<a href="https://echarts.apache.org/en/option.html#series" class="echarts-docs-btn" target="_blank">ECharts</a>
</div>
++++

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/ui-samples/sample/charts" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

`series` 元素定义展示的图表类型（例如，line，bar，scatterd 等）。每种图表类型在 `series` 元素中有不同配置。

Jmix 支持的基本图表类型包括：

* https://demo.jmix.io/ui-samples/sample/line-series-simple[线图（Line）^]
* https://demo.jmix.io/ui-samples/sample/bar-series-simple[条形图（Bar）^]
* https://demo.jmix.io/ui-samples/sample/pie-series-simple[饼图（Pie）^]
* https://demo.jmix.io/ui-samples/sample/scatter-series-simple[散点图（Scatter）^] 以及 https://demo.jmix.io/ui-samples/sample/effect-scatter-series[特效散点图^]
* https://demo.jmix.io/ui-samples/sample/candlestick-series-simple[蜡烛图（Candlestick）^]
* https://demo.jmix.io/ui-samples/sample/funnel-series-simple[漏斗图（Funnel）^]
* https://demo.jmix.io/ui-samples/sample/gauge-series-simple[仪表盘（Gauge）^]
* https://demo.jmix.io/ui-samples/sample/radar-series-simple[雷达图（Radar）^]

下面的示例中，`series` 元素定义了一个饼图：

[source,xml,indent=0]
----
include::example$charts-ex1/src/main/resources/com/company/demo/view/vehiclecount/vehicle-count-chart-view.xml[tags=series-pie]
----

`label` 元素配置饼图中的文本标签。其中 `formatter` 属性定义了一个可以包含数据项名称和值的格式。请参阅 ECharts 文档了解有关 https://echarts.apache.org/en/option.html#series-pie.label[label^] 和 https://echarts.apache.org/en/option.html#series-pie.label.formatter[formatter^] 的更多信息。

结果如下：

image::chart-component-series-1.png[align="center", width="507"]

NOTE: 一个 `chart` 元素可以包含多个 `series` 配置，此时所有图表类型会共享数据集。

[[title]]
== 标题

++++
<div class="jmix-ui-live-demo-container">
<a href="https://echarts.apache.org/en/option.html#title" class="echarts-docs-btn" target="_blank">ECharts</a>
</div>
++++

通过 `title` 属性可以展示图表的主副标题，可以自定义文字的内容、位置、对齐方式以及样式。

示例：

[source,xml,indent=0]
----
include::example$charts-ex1/src/main/resources/com/company/demo/view/vehiclecount/vehicle-count-chart-view.xml[tags=title]
----

这个配置同时指定了图表的主副标题，位置为右上角，文本居中对齐以及使用斜体字：

image::chart-component-title-1.png[align="center", width="608"]

[[legend]]
== 图例

++++
<div class="jmix-ui-live-demo-container">
<a href="https://echarts.apache.org/en/option.html#legend" class="echarts-docs-btn" target="_blank">ECharts</a>
</div>
++++

`legend` 属性展现了不同系列的标记（symbol），颜色和名字。可以通过点击图例控制哪些系列不显示。图例基于提供的数据自动生成。

[source,xml,indent=0]
----
include::example$charts-ex1/src/main/resources/com/company/demo/view/vehiclecount/vehicle-count-chart-view.xml[tags=legend]
----

这个示例中的图例标记在右侧：

image::chart-component-legend-1.png[align="center", width="608"]

[[data-zoom]]
== 数据缩放

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://echarts.apache.org/en/option.html#dataZoom" class="echarts-docs-btn" target="_blank">ECharts</a>
</div>
++++

`dataZoom` 属性提供了两个主要功能：

* *Inside data zoom* 内置于坐标系中，使用户可以在坐标系上通过鼠标拖拽、鼠标滚轮、手指滑动（触屏上）来缩放或漫游坐标系。

* *Slider type data zoom* 提供类似数据缩略图的功能，用于快速预览、放大/缩小、选择画笔、拖动移动和单击以在图表的数据范围内定位。

示例：

[source,xml,indent=0]
----
include::example$charts-ex1/src/main/resources/com/company/demo/view/vehiclecount/vehicle-count-chart-view.xml[tags=dataZoom]
----

注意其中水平和垂直方向的滑动条：

image::chart-component-data-zoom-1.png[align="center", width="613"]

[[native-json]]
== 原生 JSON

在组件的 Java API 或 XML 属性无法满足特定的图表配置要求时，使用 `nativeJson` 属性可以直接为图表提供 JSON 配置。使用这个功能可以完全实现 ECharts 的所有配置选项。

示例：

[source,xml,indent=0]
----
include::example$charts-ex1/src/main/resources/com/company/demo/view/vehiclecount/vehicle-count-chart-view.xml[tags=nativeJson]
----

这里的 `nativeJson` 元素中图表标题的配置与 <<title,上面>> XML 中配置的标题一样。

NOTE: `nativeJson` 配置会与图表已有的属性配置合并，并且能覆盖 XML 中定义的相同属性。

[[tool-box]]
== 工具栏

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://echarts.apache.org/en/option.html#toolbox" class="echarts-docs-btn" target="_blank">ECharts</a>
</div>
++++

`toolbox` 属性提供一组图表的实用工具，包含 https://echarts.apache.org/en/option.html#toolbox.feature.saveAsImage[导出图片^]、 https://echarts.apache.org/en/option.html#toolbox.feature.dataView[数据视图^]、 https://echarts.apache.org/en/option.html#toolbox.feature.magicType[动态类型切换^]、 https://echarts.apache.org/en/option.html#toolbox.feature.dataZoom[数据区域缩放^] 以及 https://echarts.apache.org/en/option.html#toolbox.feature.restore[重置配置^]。

示例，下面的配置为图表添加了导出 PNG 图片的功能：

[source,xml,indent=0]
----
include::example$charts-ex1/src/main/resources/com/company/demo/view/vehiclecount/vehicle-count-chart-view.xml[tags=toolBox]
----

导出操作显示在图表的右上角：

image::chart-component-export-1.png[align="center", width="661"]
